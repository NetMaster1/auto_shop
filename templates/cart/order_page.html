{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="container">

          <div class="row mt-4 pt-5">
            <div class="col-12">
              <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="{% url 'shopfront' %}">Главная</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Текущая</li>
                </ol>
              </nav>
            </div>
          </div>

<!-- =====================Alert Messages Module=================== -->
<div class="container">
    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-info" role="alert">
        <!-- <button class="close" data-dismiss="alert">
                    <small><sup>x</sup></small>
                </button> -->
        {{ message }}
    </div>
    {% endfor%}
    {% endif%}
</div>
<!-- ===================End of Alert Messages Module================ -->




<div class="row mb-5">Заказ # {{order.id}}</div>
<div class="row align-items-center justify-content-right"  style="height:100px">
  <div class="col-8 justify-content-right">
    <h4>Всего товаров на сумму: <strong>{{total}}&nbsp;руб.</strong></h4>
  </div>

{% for item in order_items %}
<div class="row mt-2 mb-2">
     <div class="col-1">
        <!-- <a href="{{cart_item.get_url}}"> -->
          <img src="{{item.image.url}}" width="50" alt="">
        <!-- </a> -->
      </div>

    <div class="col-4">
        {{item.product}}
    </div>
    <div class="col-2">
        {{item.quantity}}
    </div>
    <div class="col-2">
        {{item.price}}
    </div>
    <div class="col-2">
        {{item.sub_total}}
    </div>
</div>
{% endfor %}
<div class="row mt-2">
Всего к оплате: {{order.sum}} руб.
</div>

https://www.cdek.ru/ru/offices/



<form action="{% url 'sdek_office_choice' order.id %}" method="POST" id="form_to_be_sent">
          {% csrf_token %}

  <div class="row mt-2 mb-2">
  <div class="col-md-4">
    <label for="country" class="form-label">Страна</label>
     <select name="country" id="country" class='form-control' required >
        <option selected="true" disabled="disabled">Выберите страну</option>
        <!-- <option value="">Выберите страну</option> -->
        {% for country in countries %}
        <option value="{{country}}">{{country}}</option>
        {% endfor %}
      </select>
    </div>
    </div>
  
  
  <div class="row mt-2 mb-2">
  <div class="col-md-4">
    <label for="region" class="form-label">Регион</label>
       <select name="region" id="region" class='form-control'>
        <option selected="true" disabled="disabled">Выберите регион</option>
        <!-- <option value="">Выберите регион</option> -->
        {% for region in regions %}
        <option value="{{region.region}}">{{region.region}}</option>
        {% endfor %}
      </select>
    </div>
  </div>

 <div class="row mt-2 mb-2">
  <div class="col-md-6">
    <label for="city" class="form-label">Населенный пункт</label>
       <select name="city" id="city" class='form-control'>
        <option selected="true" disabled="disabled">Выберите населенный пункт в пределах вашего региона</option>
        <!-- <option value="">Выберите населенный пункт в пределах вашего региона</option> -->
        {% for city in cities %}
        <option value="{{city.city}}">{{city.city}}</option>
        {% endfor %}
      </select>
    </div>
    </div>


  <div class="row mt-2 mb-2">
  <div class="col-md-6">
    <label for="office" class="form-label">Пункт выдачи</label>
       <select name="office" id="office" class='form-control'>
        <option selected="true" disabled="disabled">Выберите пункт выдачи СДЕК в пределах вашего населенного пункта</option>
        <!-- <option value="">Выберите пункт выдачи СДЕК в пределах вашего населенного пункта</option> -->
        {% for office in offices %}
        <option value="{{office.address_full}}">{{office.address_full}}</option>
        {% endfor %}
      </select>
    </div>
  </div>

</form>

<form action="{% url 'sdek_shipment_address' order.id %}" method="POST" id="shipment_form">
   {% csrf_token %}
        <input type="text" id="shipment_office" name="shipment_office" hidden> 

      <div class="row m-auto mt-3">
          <div class="col-2">
            <input type="submit" value="Сохранить" class="btn btn-block btn-outline-primary" id="clear_storage">
          </div>
      </div>
</form>
 
      


</div>

</div>


<script>
console.log ('Beginning of the script')

const form_to_be_sent=document.querySelector('#form_to_be_sent');
const shipment_form = document.querySelector('#shipment_form');
const shipment_office = document.querySelector('#shipment_office');
const shipment_button = document.querySelector('#shipment_button');
const country = document.querySelector('#country');
const region = document.querySelector('#region');
const city = document.querySelector('#city');
const office = document.querySelector('#office');
const clear_storage = document.querySelector('#clear_storage');


//====================Country Module=======================
country.addEventListener('change', e=>{
        sessionStorage.clear();
        country_value = country.value;
        sessionStorage.setItem('country', country_value);
        city.value='';
        region.value='';
        office.value='';
    }
 )

country.addEventListener('change', sendJSForm);
    function sendJSForm() {
        form_to_be_sent.submit();
    };
//===============Region Module======================
region.addEventListener('change', e=>{
        region_value = region.value;
        sessionStorage.setItem('region', region_value);
        sessionStorage.removeItem('city');
        sessionStorage.removeItem('office');
        city.value='';
        office.valu=''
       
    }
  )
region.addEventListener('change', sendJSForm);
    function sendJSForm() {
        form_to_be_sent.submit();
    };

//===============City Module======================
city.addEventListener('change', e=>{
        city_value = city.value;
        sessionStorage.setItem('city', city_value);
        sessionStorage.removeItem('office');
        office.value=''
    }
)
city.addEventListener('change', sendJSForm);
    function sendJSForm() {
        form_to_be_sent.submit();
    };


//===============Office Module======================
office.addEventListener('change', e=>{
        office_value = office.value;
        sessionStorage.setItem('office', office_value);
        shipment_office.value = office_value;
        // sendShipmentForm();
    }
)

// function sendShipmentForm() {
//         shipment_form.submit();
//         //e.preventDefault()
//     };


// for (let button of buttons) {
//         button.addEventListener('click', clearStorage);
//     }
//     function clearStorage(e) {
//         sessionStorage.clear();
//     };

//     save_button.addEventListener('submit', e=> {
//         sessionStorage.clear();
//    })





// office.addEventListener('change', sendJSForm);
//     function sendJSForm() {
//         form_to_be_sent.submit();
//     };






document.addEventListener('DOMContentLoaded', e => {
        if (sessionStorage.getItem('country') === null)
          {console.log ("No country choice")}
        else {
          country_value = sessionStorage.getItem('country');
          country.value = country_value
        }
        if (sessionStorage.getItem('region') === null)
          {console.log ("No region choice")}
        else {
          region_value = sessionStorage.getItem('region');
          region.value = region_value
        }
        if (sessionStorage.getItem('city') === null)
          {console.log ("No city choice")}
        else {
          city_value = sessionStorage.getItem('city');
          city.value = city_value
        }
        if (sessionStorage.getItem('office') === null)
          {console.log ("No office choice")}
        else {
          office_value = sessionStorage.getItem('office');
          office.value = office_value
        }

      });

clear_storage.addEventListener('click', clearStorage);
    function clearStorage(e) {
        sessionStorage.clear();
    };

 //check_imei.value.clear()
  //e.preventDefault()

// country.addEventListener('change', function(event) {
//   console.log('Выбранное значение:', event.target.value);
// });

console.log (shipment_form)
console.log ('End of the script')
</script>
{% endblock %}